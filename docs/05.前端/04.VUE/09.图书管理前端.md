---
title: 09.图书管理前端
date: 2021-02-19 22:30:28
permalink: /pages/32f873/
categories:
  - 前端
  - VUE
tags:
  - 
---
## 01.图书管理页面

### 1.1 `http/apis.js`

```javascript
//将我们http.js中封装好的 axios_get, axios_post, axios_delete, axios_put  导过来
import { axios_get, axios_post, axios_delete, axios_put } from './index.js'

// 书籍管理接口
export const getBookList = (params, headers) => axios_get("/books/book/", params, headers)
export const addBook = (params, headers) => axios_post("/books/book/", params, headers)
export const updateBook = (params, headers) => axios_put("/books/book/", params, headers)
export const delBook = (params, headers) => axios_del("/books/book/", params, headers)
```

### 1.2 `router/index.js`

```javascript
import Books from "../views/book-manage-demo/Books";

export default new Router({
  routes: [
    { path: '/books', name: 'Books', component: Books },                 // 测试图书增删改查案例
  ]
})
```

### 1.3 `Books.vue`父组件

>  `src\views\book-manage-demo\Books.vue`

```javascript
<template>
  <div>
    <h1>图书管理系统</h1>
    <div style="margin: 30px;">
      <button @click="addNew">新增图书</button>
      <BookEdit
        v-show='dialogVisible'
        :visible.sync='dialogVisible'
        :data='editData'
        @save='save'
      ></BookEdit>
    </div>

    <div>
      <table style='margin: auto; border: solid 1px black;'>
        <tr>
          <th>图书编号</th>
          <th>图书名字</th>
          <th>出版时间</th>
          <th>阅读数</th>
          <th>评论数</th>
          <th>操作</th>
        </tr>
        <tr
          v-for="(book, index) in books"
          :key="book.id"
        >
          <td>{{book.id}}</td>
          <td>{{book.btitle}}</td>
          <td>{{book.bpub_date}}</td>
          <td>{{book.bread}}</td>
          <td>{{book.bcomment}}</td>
          <td>
            <button @click="edit(index)">修改</button>
            <button @click="del(index)">删除</button>
          </td>
        </tr>
      </table>
    </div>

  </div>
</template>

<script>
import { getBookList, addBook, updateBook, delBook } from '@/http/apis'
import BookEdit from './components/BookEdit'
export default {
  components: {
    BookEdit
  },
  data() {
    return {
      dialogVisible: false,
      books: [
        { id: 3, btitle: "...", bpub_date: "2020-08-11", bread: 100, bcomment: 50 }
      ],
      editData: {  // 编辑的内容
        btitle: "",
        bpub_date: "",
        bread: 0,
        bcomment: 0
      }
    }
  },
  methods: {
    // 1.点击新增图书时初始化数据
    addNew() {
      this.editData = {  // 初始化 编辑内容
        btitle: "",
        bpub_date: "",
        bread: 100,
        bcomment: 0
      }
      this.dialogVisible = true  // 显示弹框
    },

    // 2.获取图书列表
    get() {
      getBookList().then((data) => {
        // console.log(data)
        // books: [{btitle: "西游记", bpub_date: "2020-08-11", bread: 100, bcomment: 50}]
        this.books = data.books
      })
    },

    // 3.修改或者添加图书
    save() {
      // 根据editData中的id判断是更新还是新增
      // debugger
      console.log(this.editData)
      if (this.editData.id) {
        // 如果有id, 修改图书
        // 修改请求
        let params = this.editData
        editBook(params).then((res)=>{
          console.log(res)
          this.get()
        })
      } else {
        // 增加图书
        addBook(this.editData).then((res) => {
          this.get()
        })
      }
    },

    // 点击修改弹出修改页面
    edit(index) {
      this.editData = JSON.parse(JSON.stringify(this.books[index]))  // 复制 this.books[index] 的数据
      // this.editData = this.books[index]  //
      this.dialogVisible = true
    },

    // 删除
    del(index) {
      let params = {
        id: this.books[index].id
      }
      delBook(params).then((res)=>{
        console.log(res)
        this.get()
      })
    }
  },
  created() {
    this.get()
  }
}
</script>
<style>
table tr td {
  width: 150px;
  border: solid 1px black;
}
</style>
```

- `:visible.sync 作用`
     - :visible指的是属性绑定，表示弹框的显示隐藏，当:visible的值为ture的时候，弹框显示，当为false的时候，弹框隐藏
     - 后面的.sync指的就是同步动态双向的来表示visible的值
          -  当我们关闭窗口的时候，这个弹框隐藏了，visible的值发生了变化
          -  但是关闭窗口这个动作，我们没法用确定的动作去判断这个值，所以用到了vue中的双向绑定的原则
          -  在vue中统一加上了.sync来表示同步的修改了visible的值。

### 1.4 `BookEdit.vue`子组件

> `\src\views\book-manage-demo\components\BookEdit.vue`

```javascript
<template>
  <div>
    <el-dialog
      title="新增图书"
      :visible="visible"
    >
      <div><span>图书名称:</span>
        <el-input
          class='elinput'
          v-model="data.btitle"
        ></el-input>
      </div>
      <div><span>发布日期:</span>
        <el-input
          class='elinput'
          v-model="data.bpub_date"
        >
        </el-input>
      </div>
      <div><span>阅读量:</span>
        <el-input
          class='elinput'
          v-model="data.bread"
        ></el-input>
      </div>
      <div><span>评论量:</span>
        <el-input
          class='elinput'
          v-model="data.bcomment"
        ></el-input>
      </div>

      <el-button @click="cancel">取 消</el-button>
      <el-button
        type="primary"
        @click="addBook"
      >确 定</el-button>
    </el-dialog>
  </div>
</template>
<script>
// import { addbook } from '@/http/apis'
export default {
  props: ['data', 'visible'],
  data() {
    return {
    }
  },
  methods: {
    addBook() {
      this.$emit('update:visible', false)
      this.$emit('save')
    },
    cancel() {
      this.$emit('update:visible', false)
    }
  },
  mounted() {
  }
}
</script>
<style>
.elinput {
  width: 220px;
  height: 40px;
}
</style>
```

### 1.5 `src/mian.js`

```javascript
// The Vue build version to load with the `import` command
// (runtime-only or standalone) has been set in webpack.base.conf with an alias.
import Vue from 'vue'
import App from './App'
import router from './router'

Vue.config.productionTip = false

// 使用 elementui
// npm i element-ui -S 安装到当前项目
import ElementUI from 'element-ui'
import 'element-ui/lib/theme-chalk/index.css'
Vue.use(ElementUI)


/* eslint-disable no-new */
new Vue({
  el: '#app',
  router,
  components: { App },
  template: '<App/>'
})
```

## 02.后台接口

[图书管理后端](http://v5blog.cn:81/pages/49ae81/)